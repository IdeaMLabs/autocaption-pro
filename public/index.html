<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoCaption Pro</title>
</head>
<body>
  <h1>AutoCaption Pro</h1>
  <p>Upload your video link, pay securely, and receive your transcript.</p>

  <!-- Simple form -->
  <form id="job-form">
    <label>Email:</label><br />
    <input type="email" id="email" required /><br /><br />

    <label>YouTube URL:</label><br />
    <input type="url" id="video-url" required /><br /><br />

    <label>Tier:</label><br />
    <select id="tier">
      <option value="1">Test Tier ($1.00)</option>
    </select>
  </form>

  <h2>Pay with PayPal</h2>
  <div id="paypal-button-container"></div>

  <div id="job-result" style="margin-top:20px; font-weight:bold;"></div>

  <!-- ✅ PayPal SDK (replace with your live client ID) -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_LIVE_CLIENT_ID&currency=USD"></script>

  <script>
    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: "1.00" // ✅ $1 fixed test price
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          console.log("✅ Payment completed by " + details.payer.name.given_name);

          // Call your backend to log payment + start job
          fetch("/paypal/notify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              orderID: data.orderID,
              email: document.getElementById("email").value,
              video_url: document.getElementById("video-url").value,
              tier: document.getElementById("tier").value
            })
          })
          .then(r => r.json())
          .then(res => {
            // ✅ Show job ID + link to status
            if (res.session_id) {
              document.getElementById("job-result").innerHTML =
                "✅ Job created!<br>" +
                "Job ID: " + res.session_id + "<br>" +
                "<a href='/status?job_id=" + res.session_id + "' target='_blank'>Check Status Here</a>";
            } else {
              document.getElementById("job-result").innerHTML =
                "⚠️ Payment succeeded but job not created. Check logs.";
            }
          })
          .catch(err => {
            document.getElementById("job-result").innerText =
              "⚠️ Error creating job: " + err.message;
          });
        });
      }
    }).render("#paypal-button-container"); // ✅ This ensures button actually renders
  </script>
</body>
</html>

