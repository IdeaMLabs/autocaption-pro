<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoCaption Pro – Fast Captions & Translation</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; max-width: 720px; }
    h1 { margin-bottom: .25rem; }
    p.lead { color: #555; margin-top: 0; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; }
    label { display: block; margin: .75rem 0 .25rem; }
    input, select, button { width: 100%; padding: .75rem; font-size: 1rem; border-radius: 10px; border: 1px solid #ccc; }
    button { cursor: pointer; background: #0a84ff; color: #fff; border: none; margin-top: 1rem; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    #msg { min-height: 1.25rem; }
    small.hint { color: #777; display: block; margin-top: .25rem; }
  </style>
</head>
<body>
  <h1>AutoCaption Pro</h1>
  <p class="lead">Paste your YouTube link → click Continue → we’ll create a session. Next we’ll add PayPal.</p>

  <div class="card">
    <form id="orderForm">
      <label for="email">Email (delivery address)</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="email" required />

      <label for="video_url">YouTube URL</label>
      <input id="video_url" type="url" placeholder="https://www.youtube.com/watch?v=…" required />
      <small class="hint">Use a public, non-age-restricted video.</small>

      <label for="tier">Tier</label>
      <select id="tier" required>
        <option value="t10">$19 — up to 10 minutes</option>
        <option value="t30">$39 — up to 30 minutes</option>
        <option value="t5pack">$79 — 5-video pack (≤10m each)</option>
      </select>

      <button id="continueBtn" type="submit">Continue</button>

      <!-- Message line + (future) PayPal buttons container -->
      <p id="msg" aria-live="polite" style="margin-top:8px;"></p>
      <div id="paypal-buttons" style="display:none; margin-top:12px;"></div>
    </form>
  </div>

  <!-- No PayPal SDK yet. We just create the session and show a success message. -->
  <script>
    // Same-origin endpoint provided by your Cloudflare Pages Functions
    // (functions/session.js)
    const SESSION_ENDPOINT = '/session';

    const $ = sel => document.querySelector(sel);
    const form   = $('#orderForm');
    const emailEl = $('#email');
    const urlEl   = $('#video_url');
    const tierEl  = $('#tier');
    const btn     = $('#continueBtn');
    const msgEl   = $('#msg');
    const payDiv  = $('#paypal-buttons'); // not used yet

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      msgEl.style.color = '#000';
      msgEl.textContent = 'Creating session…';
      btn.disabled = true;

      try {
        const res = await fetch(SESSION_ENDPOINT, {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify({
            email: (emailEl?.value || '').trim(),
            video_url: (urlEl?.value || '').trim(),
            tier: (tierEl?.value || '').trim()
          })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.session_id) {
          msgEl.style.color = '#b00020';
          msgEl.textContent = data.error || 'Unable to create session.';
          btn.disabled = false;
          return;
        }

        // Store for the next steps (PayPal + status page)
        localStorage.setItem('session_id', data.session_id);

        // Success message
        msgEl.style.color = '#0a0';
        msgEl.textContent = `Session created (#${data.session_id.slice(0, 8)}).`;

        // In the next step we’ll reveal PayPal buttons here:
        // payDiv.style.display = 'block';

      } catch (err) {
        console.error(err);
        msgEl.style.color = '#b00020';
        msgEl.textContent = 'Network error. Please try again.';
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>

